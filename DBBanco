CREATE DATABASE universidade-bd;

CREATE TABLE ALUNO(                              /* criando  tabela ALUNO */ 
	IDALUNO INT PRIMARY KEY AUTO_INCREMENT,       /* Definindo uma chave primária como auto incrementação */
	NOME VARCHAR(30) NOT NULL,                    
	SEXO ENUM('M','F') NOT NULL,                  /* ENUM adicionado para informar uma lista de opções, OU Masculino ou feminino */
	EMAIL VARCHAR(50) UNIQUE,
	CPF VARCHAR(15) UNIQUE                       /* Apesar do CPF ter 11 caracteres, foi adicionado 15 caracteres como VARCHAR. o correto seria CHAR 11
);							fiz isso para mostrar que tem como fazer um tunning no banco */

CREATE TABLE ENDERECO(
	IDENDALUNO INT PRIMARY KEY AUTO_INCREMENT, 
	RUA VARCHAR(30) NOT NULL,
	BAIRRO VARCHAR(30) NOT NULL,
	CIDADE VARCHAR(30) NOT NULL,
	ESTADO CHAR(2) NOT NULL,
	ID_ALUNO INT UNIQUE

	FOREIGN KEY(ID_ALUNO)                   /* Fazendo a ligação da chave primaria com a chave estrangeira  */
	REFERENCES CLIENTE(IDALUNO)
);

CREATE TABLE TELEFONE(
	IDTELEFONE INT PRIMARY KEY AUTO_INCREMENT, 
	TIPO ENUM('RES','COM','CEL') NOT NULL,
	NUMERO VARCHAR(10) NOT NULL,
	ID_ALUNO INT UNIQUE

	FOREIGN KEY(ID_ALUNO)
	REFERENCES ALUNO (IDALUNO)
);	

CREATE TABLE CURSO(
	IDCURSO INT PRIMARY KEY AUTO_INCREMENT,
	CONTABILIDADE VARCHAR (20) NOT NULL,
	INFORMATICA VARCHAR (20) NOT NULL,
	GASTRONOMIA VARCHAR (20) NOT NULL,
	LOGISTICA VARCHAR (20) NOT NULL,
	ID_ALUNO INT,

	FOREIGN KEY (ID_ALUNO)
	REFERENCES ALUNO(IDALUNO)
);

CREATE TABLE MATRICULA (
	IDMATRICULA INT PRIMARY KEY AUTO_INCREMENT,
	STATUS ENUM ('A ver','Em Dia') NOT NULL,
	FALTAS INT (20) NOT NULL,
	ID_ALUNO INT
	
	FOREIGN KEY (ID_ALUNO)
	REFERENCES ALUNO(IDALUNO)
);



INSERT INTO ALUNO VALUES(NULL,'LEONARDO SCIGLIANO','M','SCIGLIANO_6@HOTMAIL.COM','76567587887');        /* Inserindo informações(valores) dentro da tabela ALUNO */
INSERT INTO ALUNO VALUES(NULL,'LARISSA FAGUNDES','F','LARI@GMAIL.COM','78748984');			 
INSERT INTO ALUNO VALUES(NULL,'ROBERTA@HOTMAIL.COM','F','ROBER@GMAIL.COM','78489184');
INSERT INTO ALUNO VALUES(NULL,'CARLOS24@GMAIL.COM','M','CARLOS@GMAIL.COM','41012014');

INSERT INTO ENDERECO VALUES (NULL,'Padre Anchieta','São Cristão','Passo Fundo','RS','1');
INSERT INTO ENDERECO VALUES (NULL,'Morom','Centro','Passo Fundo','RS','2');
INSERT INTO ENDERECO VALUES (NULL,'Presidente Altino','Jaguare','São Paulo','RS','3');
INSERT INTO ENDERECO VALUES (NULL,'Rio Branco','Centro','Rio de Janeiro','RJ','4');

INSERT INTO TELEFONE VALUES(NULL,'CEL','54996762603','1');
INSERT INTO TELEFONE VALUES(NULL,'RES','37633324','1');
INSERT INTO TELEFONE VALUES(NULL,'CEL','5478787480','2');
INSERT INTO TELEFONE VALUES(NULL,'CEL','11987894578','3');
INSERT INTO TELEFONE VALUES(NULL,'COM','54996762603','4');

INSERT INTO CURSO VALUES (NULL,'INFORMATICA','1');
INSERT INTO CURSO VALUES (NULL,'GASTRONOMIA','2');
INSERT INTO CURSO VALUES (NULL,'LOGISTICA','3');
INSERT INTO CURSO VALUES (NULL,'CONTABILIDADE','4');

INSERT INTO MATRICULA VALUES (NULL,'Em Dia','1','1');
INSERT INTO MATRICULA VALUES (NULL,'A Ver','1','2');
INSERT INTO MATRICULA VALUES (NULL,'Em Dia','1','3');
INSERT INTO MATRICULA VALUES (NULL,'Em Dia','1','4');



/* Fazendo UPDATE de um aluno que se mudou, Foi informado que o aluno em questão se  chamava LEONARDO SCIGLIANO */

SELECT AL.NOME,             /* É FEITO UM SELECT PARA TER CERTEZA EM QUAL REGISTRO SERÁ FEITO O UPDATE */
	ED.RUA,
    ED.BAIRRO
FROM ALUNO AL
JOIN ENDERECO ED
ON AL.IDALUNO = ED.ID_ALUNO


UPDATE ENDERECO SET
RUA = 'Lucas Araujo',
BAIRRO = 'Centro'
WHERE ID_ALUNO = 1         /* NESSE CASO O IDALUNO É 1, ENTÃO FICA FACIL FAZER ALTERAÇÕES SEM ERROS */
 
 /* É FEITO OUTRO SELECT PARA TER CERTEZA QUE FOI FEITO CORRETAMENTE O UPDATE */
 
SELECT AL.NOME,
	ED.RUA,
    ED.BAIRRO
FROM ALUNO AL
JOIN ENDERECO ED
ON AL.IDALUNO = ED.ID_ALUNO






SELECT  AL.*,                       /* O Gestor pediu para trazer todos os dados do aluno Leonardo, o ID dele é o 1, então projetamos e juntamos 
	END.*, 				todas as informações nas tabelas desejadas */
	TEL.*, 
	C.* , 
	MAT.*
FROM ALUNO AL
JOIN ENDERECO END
ON AL.IDALUNO = END.ID_ALUNO
JOIN TELEFONE TEL
ON AL.IDALUNO = TEL.ID_ALUNO              /*NESSE CASO, para não confundir o banco e não ficar ambiguo o comando, precisei colocar o apelido dado na frente do ON */
JOIN CURSO C
ON AL.IDALUNO = C.ID_ALUNO
JOIN MATRICULA MAT
ON AL.IDALUNO = MAT.ID_ALUNO
where IDALUNO = 1;



CREATE VIEW RE_ALUNO AS      /* Criando VIEWS do select para facilitar o processo de projeção de informações */
SELECT  AL.*,                       
	END.*, 				
	TEL.*, 
	C.* , 
	MAT.*
FROM ALUNO AL
JOIN ENDERECO END
ON AL.IDALUNO = END.ID_ALUNO
JOIN TELEFONE TEL
ON AL.IDALUNO = TEL.ID_ALUNO
JOIN CURSO C
ON AL.IDALUNO = C.ID_ALUNO
JOIN MATRICULA MAT
ON AL.IDALUNO = MAT.ID_ALUNO
where IDALUNO = 1;


SELECT * FROM RELATORIO    /* Aqui eu fiz um select da view para facilitar as pesquisas no dia-a-dia. */
WHERE IDALUNO = 1;
